<!--mini_insta/search_results.html-->
<!--Aidan Xu (axu26@bu.edu), 10/13/25-->
<!--Displays the stuff from the query search.-->

{% extends 'mini_insta/base.html' %}

{% block content %}
    <div class="forms">
        <h1>Results for "{{query}}"</h1>
        <h3>Profiles ({{profiles.count}})</h3>
    <!--iterate through all of the profiles and display them-->
        {% for p in profiles %}
            <div class="post_caption">
                <div class="pfp">
                    <a href="{% url 'show_profile' p.pk %}">
                        <img src="{{p.profile_image_url}}" alt="pfp" class="img_hover">
                    </a>
                </div>
                <div class="caption">
                    <a href="{% url 'show_profile' p.pk %}" class="post_name">
                        {{p.display_name}}
                    </a>
                    <span>{{p.username}}</span>
                    <p class="search_prof_info">Joined on {{p.join_date}} • 
                        {{p.get_num_followers}} followers • 
                        {{p.get_posts_count}} posts
                    </p>
                </div>
            </div>
            <hr>
        {% endfor %}
        <h3>Posts ({{posts.count}})</h3>
    <!--iterate through all of the posts and display them-->
        {% for post in posts %}
        <!--borrowing a lot of code from previous thing-->
        <!--displays profile picture, names, caption, timestamp, and photo-->
            <div class="post_caption">
                <div class="pfp">
                    <a href="{% url 'show_profile' post.profile.pk %}">
                        <img src="{{post.profile.profile_image_url}}" alt="pfp" class="img_hover">
                    </a>
                </div>
            <!--all the actual content of a post here-->
                <div class="caption">
                    <a href="{% url 'show_profile' post.profile.pk %}" class="post_name">
                        {{post.profile.display_name}}
                    </a>
                    <span>@{{post.profile.username}} on {{post.timestamp}}</span>
                    <a href="{% url 'show_post' post.pk %}" class="block_please">
                        <p>
                            {{post.caption}}
                        </p>
                    </a>
                <!--check if we can show a photo for the feed-->
                    {% if post.can_show_photo_feed %}
                        <a href="{% url 'show_post' post.pk %}">
                            <img src="{{post.get_first_photo}}" alt="photo">
                        </a>
                    {% endif %}
                    <p>{{post.get_like_count}} {{post.get_example_likers}}</p>
                <!--display a few example comments-->
                    {% for comment in post.get_first_few_comments %}
                        <hr>
                        <div class="comment">
                            <a href="{% url 'show_profile' comment.profile.pk %}" 
                            class="comment_img_container">
                                <img src="{{comment.profile.profile_image_url}}" class="img_hover">
                            </a>
                            <div class="comment_text">
                                <a href="{% url 'show_profile' comment.profile.pk %}">
                                    <strong>{{comment.profile.display_name}}</strong>
                                </a>
                                <span> on {{comment.timestamp}}</span>
                                <p>{{comment.text}}</p>
                            </div>
                        </div>
                    {% endfor %}
                <!--show remaining comments if there are more than the few shown-->
                    <p class="additional_comments">{{post.get_comments_left_feed}}</p>
                </div>
            </div>
            <hr>
        {% endfor %}
    </div>
{% endblock %}